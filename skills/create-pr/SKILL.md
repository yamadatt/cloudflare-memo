---
name: create-pr
description: ローカルのGit差分から、関連Issueを含むレビューしやすいPRタイトルと本文を作成し、GitHub CLI（gh）でPRを作成する。PR作成依頼、PR本文ドラフト、差分要約、レビューポイント整理、Issue紐付け、`gh pr create` 実行が求められたときに使う。MCPは使わない。
---

# PR作成

この手順で、レビューしやすいPRドラフトを作成する。
PR作成は GitHub CLI（`gh`）を使い、MCPは使わない。

## 手順

1. ベースブランチを確定する。
- 基本は `origin/main` を使う。
- 既定ブランチが別なら、そちらを使う。

2. ブランチ情報を収集する。
- `scripts/collect_pr_context.sh <base-branch>` を実行する。
- ブランチ名、コミット一覧、変更ファイル、差分統計、関連Issue候補を確認する。

3. 関連Issueを確定する。
- Issue番号を `#123` 形式で確定する。
- PR本文に「関連Issue」セクションを必ず入れる。
- クローズ対象なら `Closes #123`（または `Fixes #123`）を明記する。
- 関連Issueが不明な場合は、作成前に確認を取り、未確定のまま作成しない。

4. PRタイトルを作成する。
- 命令形で書く。
- 範囲が明確なら scope を含める（例: `api: webhook署名検証を追加`）。
- 可能なら72文字程度に収める。

5. テンプレートからPR本文を作成する。
- `references/pr-template.md` を使う。
- 各セクションを実差分に基づいて埋める。
- 箇条書きは事実ベース・ファイルベースで書く。

6. 最終化前に品質確認する。
- 「変更内容」が実際の変更ファイルと対応していることを確認する。
- 「テスト方法」に実行済みコマンドを記載する。
- 「リスク」「ロールバック」を具体的に書く。
- 「関連Issue」に有効なIssue番号が入っていることを確認する。
- 未記入プレースホルダを残さない。

7. GitHub CLI でPRを作成する。
- `gh pr create --base <base> --head <branch> --title "..." --body-file <file>` を使う。
- `gh` が使えない場合は、`gh` の導入手順を案内し、PR本文ドラフトまでを返す。

## 出力形式

以下を返す:
1. 提案PRタイトル
2. 完成PR本文（Markdown）
3. テスト実行結果の要約
4. 残課題・フォローアップ
